{% extends "base.html" %}
{% block content %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm@5.1.0/css/xterm.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/xterm@5.1.0/lib/xterm.min.js"></script>

<style>
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Share+Tech+Mono&display=swap');
    
    .terminal-challenge-wrapper {
        position: relative;
        min-height: 100vh;
        padding: 3rem 1rem;
        background: #000;
        overflow: hidden;
    }
    
    /* Ø®Ù„ÙÙŠØ© Ù‡Ø§ÙƒØ± Ù…ØªØ­Ø±ÙƒØ© */
    .hacker-bg {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: 
            linear-gradient(0deg, transparent 24%, rgba(0, 255, 0, 0.03) 25%, rgba(0, 255, 0, 0.03) 26%, transparent 27%),
            linear-gradient(90deg, transparent 24%, rgba(0, 255, 0, 0.03) 25%, rgba(0, 255, 0, 0.03) 26%, transparent 27%);
        background-size: 50px 50px;
        animation: matrix-rain 20s linear infinite;
        z-index: 0;
        pointer-events: none;
    }
    
    @keyframes matrix-rain {
        0% { background-position: 0 0; }
        100% { background-position: 50px 50px; }
    }
    
    /* ÙƒÙˆØ¯ Ù…Ø§ØªØ±ÙƒØ³ Ù…ØªØ³Ø§Ù‚Ø· */
    .matrix-canvas {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 0;
        opacity: 0.15;
        pointer-events: none;
    }
    
    /* Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
    .terminal-content {
        position: relative;
        z-index: 2;
        max-width: 1200px;
        margin: 0 auto;
    }
    
    /* Ø§Ù„Ù‡ÙŠØ¯Ø± */
    .challenge-header {
        text-align: center;
        margin-bottom: 3rem;
        position: relative;
    }
    
    .challenge-header::before,
    .challenge-header::after {
        content: '';
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
        width: 400px;
        height: 2px;
    }
    
    .challenge-header::before {
        top: -20px;
        background: linear-gradient(90deg, transparent, #0f0, transparent);
        box-shadow: 0 0 10px #0f0;
    }
    
    .challenge-header::after {
        bottom: -20px;
        background: linear-gradient(90deg, transparent, var(--primary-gold), transparent);
        box-shadow: 0 0 10px var(--primary-gold);
    }
    
    .challenge-title {
        font-family: 'Orbitron', sans-serif;
        font-size: 2.5rem;
        color: #0f0;
        text-shadow: 
            0 0 10px #0f0,
            0 0 20px #0f0,
            0 0 30px #0f0;
        margin-bottom: 1rem;
        animation: glitch-title 3s infinite;
    }
    
    @keyframes glitch-title {
        0%, 90%, 100% {
            text-shadow: 
                0 0 10px #0f0,
                0 0 20px #0f0;
        }
        92%, 98% {
            text-shadow: 
                -2px 0 10px #f00,
                2px 0 20px #00f,
                0 0 30px #0f0;
            transform: skew(0.5deg);
        }
    }
    
    /* ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ù‡Ù…Ø© */
    .mission-panel {
        background: linear-gradient(135deg, rgba(0, 255, 0, 0.1), rgba(0, 255, 0, 0.05));
        border: 2px solid #0f0;
        border-radius: 15px;
        padding: 2rem;
        margin-bottom: 2rem;
        position: relative;
        overflow: hidden;
    }
    
    .mission-panel::before {
        content: '[ MISSION BRIEFING ]';
        position: absolute;
        top: -12px;
        left: 50%;
        transform: translateX(-50%);
        background: #000;
        padding: 5px 20px;
        color: #0f0;
        font-family: 'Orbitron', sans-serif;
        font-weight: bold;
        font-size: 0.9rem;
        border: 2px solid #0f0;
        border-radius: 20px;
        box-shadow: 0 0 15px #0f0;
    }
    
    .mission-panel::after {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(0, 255, 0, 0.2), transparent);
        animation: scan-mission 3s infinite;
    }
    
    @keyframes scan-mission {
        0% { left: -100%; }
        100% { left: 100%; }
    }
    
    .mission-text {
        position: relative;
        z-index: 1;
        font-size: 1.1rem;
        line-height: 1.8;
        color: #fff;
    }
    
    .mission-text i {
        color: #0f0;
        margin-left: 10px;
    }
    
    .mission-text b {
        color: var(--primary-gold);
        text-shadow: 0 0 10px var(--primary-gold);
    }
    
    /* Ø­Ø§ÙˆÙŠØ© Ø§Ù„ØªØ±Ù…ÙŠÙ†Ø§Ù„ */
    .terminal-box {
        max-width: 1000px;
        margin: 0 auto 2rem;
        border: 3px solid var(--primary-gold);
        border-radius: 20px;
        background: #000;
        box-shadow: 
            0 0 40px rgba(201, 169, 98, 0.4),
            inset 0 0 60px rgba(0, 255, 0, 0.05);
        position: relative;
        overflow: hidden;
    }
    
    .terminal-box::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, 
            transparent,
            #0f0,
            var(--primary-gold),
            #0f0,
            transparent
        );
        animation: border-glow 3s linear infinite;
    }
    
    @keyframes border-glow {
        0% { transform: translateX(-100%); }
        100% { transform: translateX(100%); }
    }
    
    /* Ù‡ÙŠØ¯Ø± Ø§Ù„ØªØ±Ù…ÙŠÙ†Ø§Ù„ */
    .term-header {
        background: linear-gradient(135deg, rgba(0, 255, 0, 0.2), rgba(0, 100, 0, 0.2));
        padding: 15px 25px;
        border-bottom: 2px solid var(--primary-gold);
        display: flex;
        align-items: center;
        justify-content: space-between;
    }
    
    .term-title {
        font-family: 'Orbitron', sans-serif;
        font-size: 1.1rem;
        color: #0f0;
        display: flex;
        align-items: center;
        gap: 12px;
        text-shadow: 0 0 10px #0f0;
    }
    
    .system-status {
        display: flex;
        align-items: center;
        gap: 15px;
        font-family: 'Share Tech Mono', monospace;
        font-size: 0.9rem;
        color: #0f0;
    }
    
    .status-item {
        display: flex;
        align-items: center;
        gap: 5px;
    }
    
    .status-led {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: #0f0;
        box-shadow: 0 0 10px #0f0;
        animation: blink-led 2s infinite;
    }
    
    @keyframes blink-led {
        0%, 50%, 100% { opacity: 1; }
        25%, 75% { opacity: 0.3; }
    }
    
    .term-buttons {
        display: flex;
        gap: 8px;
    }
    
    .term-btn {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        cursor: pointer;
        transition: all 0.3s;
    }
    
    .term-btn.close { background: #f00; box-shadow: 0 0 10px #f00; }
    .term-btn.minimize { background: #ff0; box-shadow: 0 0 10px #ff0; }
    .term-btn.maximize { background: #0f0; box-shadow: 0 0 10px #0f0; }
    
    .term-btn:hover {
        transform: scale(1.3);
    }
    
    #terminal {
        padding: 20px;
        min-height: 450px;
    }
    
    /* Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© */
    .help-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 2rem;
        max-width: 1000px;
        margin-left: auto;
        margin-right: auto;
    }
    
    .help-card {
        background: rgba(0, 255, 0, 0.05);
        border: 2px solid #0f0;
        border-radius: 12px;
        padding: 20px;
        transition: all 0.3s;
        position: relative;
        overflow: hidden;
    }
    
    .help-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(0, 255, 0, 0.2), transparent);
        transition: left 0.5s;
    }
    
    .help-card:hover::before {
        left: 100%;
    }
    
    .help-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 30px rgba(0, 255, 0, 0.3);
        border-color: var(--primary-gold);
    }
    
    .help-card i {
        font-size: 2rem;
        color: #0f0;
        margin-bottom: 15px;
        display: block;
    }
    
    .help-card h4 {
        font-family: 'Orbitron', sans-serif;
        color: var(--primary-gold);
        margin-bottom: 10px;
    }
    
    .help-card code {
        background: rgba(0, 255, 0, 0.2);
        padding: 3px 8px;
        border-radius: 5px;
        color: #0f0;
        font-family: 'Share Tech Mono', monospace;
    }
    
    /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
    .submit-zone {
        max-width: 1000px;
        margin: 0 auto;
        text-align: center;
        padding: 30px;
        background: linear-gradient(135deg, rgba(201, 169, 98, 0.1), rgba(201, 169, 98, 0.05));
        border-radius: 15px;
        border: 2px solid var(--primary-gold);
        position: relative;
    }
    
    .submit-zone::before {
        content: '[ SUBMIT FLAG ]';
        position: absolute;
        top: -12px;
        left: 50%;
        transform: translateX(-50%);
        background: #000;
        padding: 5px 20px;
        color: var(--primary-gold);
        font-family: 'Orbitron', sans-serif;
        font-weight: bold;
        border: 2px solid var(--primary-gold);
        border-radius: 20px;
        box-shadow: 0 0 15px var(--primary-gold);
    }
    
    .flag-input {
        padding: 15px 20px !important;
        border-radius: 10px !important;
        border: 2px solid var(--primary-gold) !important;
        background: rgba(0, 0, 0, 0.7) !important;
        color: var(--primary-gold) !important;
        width: 400px !important;
        max-width: 90% !important;
        font-size: 1.1rem !important;
        font-family: 'Share Tech Mono', monospace !important;
        text-align: center !important;
        transition: all 0.3s !important;
    }
    
    .flag-input:focus {
        outline: none !important;
        border-color: #0f0 !important;
        box-shadow: 
            0 0 20px rgba(0, 255, 0, 0.5),
            inset 0 0 10px rgba(0, 255, 0, 0.1) !important;
        transform: scale(1.05) !important;
    }
    
    .flag-input::placeholder {
        color: #888 !important;
    }
    
    .submit-btn {
        padding: 15px 40px !important;
        background: linear-gradient(135deg, #0f0, #00cc00) !important;
        border: 2px solid #0f0 !important;
        font-weight: bold !important;
        cursor: pointer !important;
        border-radius: 10px !important;
        color: #000 !important;
        font-size: 1.1rem !important;
        font-family: 'Orbitron', sans-serif !important;
        margin-top: 20px !important;
        transition: all 0.3s !important;
        text-transform: uppercase !important;
        box-shadow: 0 5px 20px rgba(0, 255, 0, 0.3) !important;
    }
    
    .submit-btn:hover {
        transform: translateY(-3px) !important;
        box-shadow: 0 8px 30px rgba(0, 255, 0, 0.6) !important;
        background: linear-gradient(135deg, #00ff00, #00ff00) !important;
    }
    
    .msg-display {
        margin-top: 20px;
        padding: 15px;
        border-radius: 10px;
        font-weight: bold;
        font-size: 1.1rem;
        animation: fadeIn 0.5s;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(-20px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    /* Ø²Ø± Ø§Ù„Ø±Ø¬ÙˆØ¹ */
    .back-btn {
        position: fixed;
        top: 25px;
        right: 25px;
        z-index: 1000;
        background: linear-gradient(135deg, var(--primary-gold), #d4b875);
        color: #000;
        border: 2px solid var(--primary-gold);
        padding: 15px 30px;
        border-radius: 50px;
        font-weight: 900;
        font-size: 1.1rem;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 10px;
        transition: all 0.4s;
        box-shadow: 0 10px 30px rgba(201, 169, 98, 0.4);
        font-family: 'Orbitron', sans-serif;
        text-decoration: none;
    }
    
    .back-btn:hover {
        transform: translateY(-5px) scale(1.05);
        box-shadow: 0 15px 40px rgba(201, 169, 98, 0.7);
    }
    
    .back-btn i {
        transition: transform 0.3s;
    }
    
    .back-btn:hover i {
        transform: translateX(5px);
    }
    
    /* Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© */
    @media (max-width: 768px) {
        .challenge-title {
            font-size: 1.8rem;
        }
        
        .help-cards {
            grid-template-columns: 1fr;
        }
        
        .flag-input {
            width: 100% !important;
        }
        
        .back-btn {
            padding: 12px 20px;
            font-size: 1rem;
        }
    }
</style>

<!-- Canvas Ù„Ù„Ù…Ø§ØªØ±ÙƒØ³ -->
<canvas id="matrixCanvas" class="matrix-canvas"></canvas>

<!-- Ø§Ù„Ø®Ù„ÙÙŠØ© -->
<div class="hacker-bg"></div>

<!-- Ø²Ø± Ø§Ù„Ø±Ø¬ÙˆØ¹ -->
<a href="/challenges" class="back-btn">
    <i class="fas fa-arrow-right"></i>
    <span>BACK</span>
</a>

<div class="terminal-challenge-wrapper">
    <div class="terminal-content">
        <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
        <div class="challenge-header">
            <h2 class="challenge-title">
                <i class="fas fa-terminal"></i> 
                ØªØ­Ø¯ÙŠ Ø§Ø®ØªØ±Ø§Ù‚ Ø§Ù„Ø®Ø§Ø¯Ù… Ø§Ù„Ù…Ø­Ù„ÙŠ
            </h2>
        </div>

        <!-- ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ù‡Ù…Ø© -->
        <div class="mission-panel">
            <div class="mission-text">
                <p>
                    <i class="fas fa-crosshairs"></i>
                    <b>Ø§Ù„Ù…Ù‡Ù…Ø©:</b> Ù‚Ù… Ø¨Ø§Ø®ØªØ±Ø§Ù‚ Ø§Ù„Ø®Ø§Ø¯Ù… Ø§Ù„Ù…Ø­Ù„ÙŠ ÙˆØ§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ù„Ù Ø³Ø±ÙŠ ÙŠØ³Ù…Ù‰ <b>flag.txt</b> ÙˆØ§Ù‚Ø±Ø£ Ù…Ø­ØªÙˆØ§Ù‡.
                </p>
                <p style="margin-top: 10px;">
                    <i class="fas fa-shield-alt"></i>
                    <b>Ø§Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ:</b> Ø­ØµÙ„Øª Ø¹Ù„Ù‰ ÙˆØµÙˆÙ„ Shell Ø¥Ù„Ù‰ Ø®Ø§Ø¯Ù… Linux. Ø§Ø³ØªØ®Ø¯Ù… Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù†Ø¸Ø§Ù… Ù„Ù„ØªÙ†Ù‚Ù„ ÙˆØ§ÙƒØªØ´Ø§Ù Ø§Ù„Ù€ Flag Ø§Ù„Ù…Ø®ÙÙŠ.
                </p>
            </div>
        </div>

        <!-- Ø­Ø§ÙˆÙŠØ© Ø§Ù„ØªØ±Ù…ÙŠÙ†Ø§Ù„ -->
        <div class="terminal-box">
            <div class="term-header">
                <div class="term-title">
                    <i class="fas fa-server"></i>
                    <span>NBU CYBERLAB OS v1.0.4</span>
                </div>
                <div class="system-status">
                    <div class="status-item">
                        <div class="status-led"></div>
                        <span>ONLINE</span>
                    </div>
                    <div class="term-buttons">
                        <div class="term-btn close"></div>
                        <div class="term-btn minimize"></div>
                        <div class="term-btn maximize"></div>
                    </div>
                </div>
            </div>
            <div id="terminal"></div>
        </div>

        <!-- Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© -->
        <div class="help-cards">
            <div class="help-card">
                <i class="fas fa-list"></i>
                <h4>Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„ÙØ§Øª</h4>
                <p>Ø§Ø³ØªØ®Ø¯Ù… <code>ls</code> Ù„Ø¹Ø±Ø¶ Ù…Ø­ØªÙˆÙŠØ§Øª Ø§Ù„Ù…Ø¬Ù„Ø¯ Ø§Ù„Ø­Ø§Ù„ÙŠ</p>
            </div>
            
            <div class="help-card">
                <i class="fas fa-file-alt"></i>
                <h4>Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„ÙØ§Øª</h4>
                <p>Ø§Ø³ØªØ®Ø¯Ù… <code>cat [filename]</code> Ù„Ù‚Ø±Ø§Ø¡Ø© Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù„ÙØ§Øª</p>
            </div>
            
            <div class="help-card">
                <i class="fas fa-user"></i>
                <h4>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h4>
                <p>Ø¬Ø±Ø¨ <code>whoami</code> Ùˆ <code>pwd</code> Ù„Ù…Ø¹Ø±ÙØ© Ù…ÙˆÙ‚Ø¹Ùƒ</p>
            </div>
            
            <div class="help-card">
                <i class="fas fa-question-circle"></i>
                <h4>Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©</h4>
                <p>Ø§ÙƒØªØ¨ <code>help</code> Ù„Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…ØªØ§Ø­Ø©</p>
            </div>
        </div>

        <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ -->
        <div class="submit-zone">
            <form method="POST">
                <input type="text" name="flag" class="flag-input" placeholder="NBU{...}" required>
                <button type="submit" class="submit-btn">
                    <i class="fas fa-paper-plane"></i> SUBMIT
                </button>
            </form>
            
            {% if msg %}
            <div class="msg-display" style="{% if 'ØµØ­ÙŠØ­' in msg or 'Ù…Ø°Ù‡Ù„' in msg %}background: rgba(0, 255, 0, 0.2); color: #0f0; border: 2px solid #0f0;{% else %}background: rgba(255, 0, 0, 0.2); color: #f00; border: 2px solid #f00;{% endif %}">
                {{ msg }}
            </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
    // Ø±Ø³Ù… Matrix ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©
    const canvas = document.getElementById('matrixCanvas');
    const ctx = canvas.getContext('2d');
    
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    
    const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789@#$%^&*()';
    const fontSize = 14;
    const columns = canvas.width / fontSize;
    const drops = Array(Math.floor(columns)).fill(1);
    
    function drawMatrix() {
        ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        ctx.fillStyle = '#0f0';
        ctx.font = fontSize + 'px monospace';
        
        for (let i = 0; i < drops.length; i++) {
            const text = letters[Math.floor(Math.random() * letters.length)];
            ctx.fillText(text, i * fontSize, drops[i] * fontSize);
            
            if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) {
                drops[i] = 0;
            }
            drops[i]++;
        }
    }
    
    setInterval(drawMatrix, 35);
    
    window.addEventListener('resize', () => {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    });

    // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªØ±Ù…ÙŠÙ†Ø§Ù„
    const term = new Terminal({
        cursorBlink: true,
        theme: {
            background: '#000000',
            foreground: '#c9a962',
            cursor: '#c9a962',
            selection: 'rgba(201, 169, 98, 0.3)',
            black: '#000000',
            red: '#ff0000',
            green: '#00ff00',
            yellow: '#ffff00',
            blue: '#0000ff',
            magenta: '#ff00ff',
            cyan: '#00ffff',
            white: '#ffffff'
        },
        fontFamily: 'Share Tech Mono, Courier New, monospace',
        fontSize: 15,
        lineHeight: 1.4
    });

    term.open(document.getElementById('terminal'));
    
    // Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨
    const bootSequence = [
        '\x1b[32mâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\x1b[0m',
        '\x1b[32mâ•‘  NBU CYBERLAB OS v1.0.4 - SECURE SHELL ACCESS          â•‘\x1b[0m',
        '\x1b[32mâ•‘  Kernel: Linux 5.15.0-nbu (x86_64)                     â•‘\x1b[0m',
        '\x1b[32mâ•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\x1b[0m',
        '',
        '\x1b[33m[*] Establishing secure connection...\x1b[0m',
        '\x1b[32m[âœ“] Authentication successful\x1b[0m',
        '\x1b[32m[âœ“] Shell access granted\x1b[0m',
        '\x1b[32m[âœ“] User privileges loaded\x1b[0m',
        '',
        '\x1b[36mWelcome to NBU Cyberlab Training Environment\x1b[0m',
        '\x1b[36mType "help" to see available commands\x1b[0m',
        ''
    ];
    
    let bootIndex = 0;
    function bootUp() {
        if (bootIndex < bootSequence.length) {
            term.writeln(bootSequence[bootIndex]);
            bootIndex++;
            setTimeout(bootUp, 150);
        } else {
            term.write('\r\n$ ');
        }
    }
    bootUp();

    let currentInput = '';
    let commandHistory = [];
    let historyIndex = -1;
    
    term.onData(e => {
        if (e === '\r') { // Enter
            term.write('\r\n');
            if (currentInput.trim()) {
                commandHistory.push(currentInput.trim());
                historyIndex = commandHistory.length;
                processCommand(currentInput.trim());
            }
            currentInput = '';
            term.write('$ ');
        } else if (e === '\u007F') { // Backspace
            if (currentInput.length > 0) {
                currentInput = currentInput.slice(0, -1);
                term.write('\b \b');
            }
        } else if (e === '\u001b[A') { // Arrow Up
            if (historyIndex > 0) {
                historyIndex--;
                term.write('\r\x1b[K$ ' + commandHistory[historyIndex]);
                currentInput = commandHistory[historyIndex];
            }
        } else if (e === '\u001b[B') { // Arrow Down
            if (historyIndex < commandHistory.length - 1) {
                historyIndex++;
                term.write('\r\x1b[K$ ' + commandHistory[historyIndex]);
                currentInput = commandHistory[historyIndex];
            } else {
                historyIndex = commandHistory.length;
                term.write('\r\x1b[K$ ');
                currentInput = '';
            }
        } else {
            currentInput += e;
            term.write(e);
        }
    });

    function processCommand(cmd) {
        const command = cmd.toLowerCase().trim();
        
        if (command === 'help' || command === '?') {
            term.writeln('');
            term.writeln('\x1b[36mâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\x1b[0m');
            term.writeln('\x1b[36mâ•‘  AVAILABLE COMMANDS                                â•‘\x1b[0m');
            term.writeln('\x1b[36mâ• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£\x1b[0m');
            term.writeln('\x1b[36mâ•‘\x1b[0m  \x1b[32mls\x1b[0m           - List files and directories          \x1b[36mâ•‘\x1b[0m');
            term.writeln('\x1b[36mâ•‘\x1b[0m  \x1b[32mcat [file]\x1b[0m   - Display file contents                \x1b[36mâ•‘\x1b[0m');
            term.writeln('\x1b[36mâ•‘\x1b[0m  \x1b[32mwhoami\x1b[0m       - Display current user                 \x1b[36mâ•‘\x1b[0m');
            term.writeln('\x1b[36mâ•‘\x1b[0m  \x1b[32mpwd\x1b[0m          - Print working directory              \x1b[36mâ•‘\x1b[0m');
            term.writeln('\x1b[36mâ•‘\x1b[0m  \x1b[32mdate\x1b[0m         - Display system date/time             \x1b[36mâ•‘\x1b[0m');
            term.writeln('\x1b[36mâ•‘\x1b[0m  \x1b[32muname\x1b[0m        - Display system information           \x1b[36mâ•‘\x1b[0m');
            term.writeln('\x1b[36mâ•‘\x1b[0m  \x1b[32mclear\x1b[0m        - Clear terminal screen                \x1b[36mâ•‘\x1b[0m');
            term.writeln('\x1b[36mâ•‘\x1b[0m  \x1b[32mhelp\x1b[0m         - Show this help message               \x1b[36mâ•‘\x1b[0m');
            term.writeln('\x1b[36mâ•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\x1b[0m');
            term.writeln('');
        }
        else if (command === 'ls' || command === 'ls -la' || command === 'dir') {
            term.writeln('\x1b[33m[*] Listing directory contents...\x1b[0m');
            setTimeout(() => {
                term.writeln('');
                term.writeln('\x1b[34mconfig.php\x1b[0m       - Configuration file');
                term.writeln('\x1b[34mdatabase.sql\x1b[0m     - Database backup');
                term.writeln('\x1b[32mflag.txt\x1b[0m         - \x1b[31m[RESTRICTED]\x1b[0m Secret file');
                term.writeln('\x1b[36mlogs/\x1b[0m            - Log directory');
                term.writeln('');
                term.writeln('\x1b[33m[!] Found interesting file: flag.txt\x1b[0m');
            }, 300);
        }
        else if (command === 'whoami') {
            term.writeln('\x1b[32mnbu_student_hacker\x1b[0m');
        }
        else if (command === 'pwd') {
            term.writeln('\x1b[36m/home/nbu_student/server_data\x1b[0m');
        }
        else if (command === 'date') {
            const now = new Date();
            term.writeln('\x1b[36m' + now.toString() + '\x1b[0m');
        }
        else if (command === 'uname' || command === 'uname -a') {
            term.writeln('\x1b[36mLinux nbu-cyberlab 5.15.0-nbu #1 SMP x86_64 GNU/Linux\x1b[0m');
        }
        else if (command === 'cat flag.txt' || command === 'cat ./flag.txt') {
            term.writeln('\x1b[33m[*] Reading flag.txt...\x1b[0m');
            setTimeout(() => {
                term.writeln('');
                term.writeln('\x1b[32mâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\x1b[0m');
                term.writeln('\x1b[32mâ•‘  ğŸ´ FLAG DISCOVERED                                â•‘\x1b[0m');
                term.writeln('\x1b[32mâ• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£\x1b[0m');
                term.writeln('\x1b[32mâ•‘                                                    â•‘\x1b[0m');
                term.writeln('\x1b[32mâ•‘  CONTENT: \x1b[33mNBU{Linux_Master_2026}\x1b[32m                â•‘\x1b[0m');
                term.writeln('\x1b[32mâ•‘                                                    â•‘\x1b[0m');
                term.writeln('\x1b[32mâ•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\x1b[0m');
                term.writeln('');
                term.writeln('\x1b[32m[âœ“] Flag retrieved successfully!\x1b[0m');
                term.writeln('\x1b[33m[!] Submit this flag in the form below to complete the challenge\x1b[0m');
            }, 500);
        }
        else if (command.startsWith('cat ')) {
            const filename = command.substring(4).trim();
            term.writeln(`\x1b[31m-bash: cat: ${filename}: No such file or directory\x1b[0m`);
        }
        else if (command === 'clear' || command === 'cls') {
            term.clear();
            term.writeln('\x1b[32m[âœ“] Terminal cleared\x1b[0m');
            term.write('\r\n');
        }
        else if (command === 'exit' || command === 'quit') {
            term.writeln('\x1b[31m[!] Cannot exit. Complete the challenge first!\x1b[0m');
        }
        else if (command.trim() === '') {
            // ÙØ§Ø±Øº
        }
        else {
            term.writeln(`\x1b[31m-bash: ${cmd}: command not found\x1b[0m`);
            term.writeln('\x1b[33m[!] Type "help" for available commands\x1b[0m');
        }
    }
</script>

<!-- SweetAlert2 -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

{% endblock %}